<!doctype html>
<html lang="en-US" class="loading">
<head>
	<meta charset="utf-8">
	<!-- From HTML 5 Boilerplate: Use .htaccess instead. See: h5bp.com/i/378 -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>harness launcher</title>

	<meta name="description" content="">
	<meta name="viewport" content="width=device-width">

	<style>
		/* good enough for demo */
		iframe {
			width: 100%;
			height: 720px;
		}
	</style>
</head>
<body>
</body>
<script>
var curl;
(function (global) {
	var curlUrl, callbackKey, init;

	// load curl, then configure test env, then run tests

	curlUrl = '../../lib/curl/src/curl.js';
	callbackKey = 'harnessCallback';

	function loadCurl (cb) {
		var script;

		script = document.createElement('script');
		script.onload = function () {
			configureCurl();
			cb();
		};
		script.onerror = function () {
			console.log('could not load curl!');
		};
		script.src = curlUrl;
		(document.head || document.getElementsByTagName('head')[0]).appendChild(script);
	}

	function configureCurl () {
		curl({
			baseUrl: '../../',
			packages: [
				{ name: 'curl', location: 'lib/curl/src/curl', main: '../curl' },
				{ name: 'wire', location: 'lib/wire', main: './wire' },
				{ name: 'when', location: 'lib/when', main: './when' },
				{ name: 'rest', location: 'lib/rest', main: './rest' },
				{ name: 'meld', location: 'lib/meld', main: './meld' },
				{ name: 'poly', location: 'lib/poly', main: './poly' },
				{ name: 'cola', location: 'lib/cola', main: './cola' },
				{ name: 'integration', location: 'lib/integration', main: 'integration' },
				{ name: 'clicks', location: 'lib/clicks', main: 'clicks' }
			]
		});
	}

	// load harness in test frame
	function loadHarness (url, node) {
		var iframe;
		iframe = node.ownerDocument.createElement('iframe');
		node.appendChild(iframe);
		iframe.src = url;
	}

	global[callbackKey] = function (cb) {
		init = cb;
		checkToStart();
	};

	function checkToStart () {
		if (curl && init) {
			delete global[callbackKey];
			init(curl);
		}
	}

	function getHarnessUrl () {
		var hUrl;
		hUrl = document.location.hash.substr(1);
		return hUrl + '#' + callbackKey;
	}

	loadCurl(checkToStart);
	loadHarness(getHarnessUrl(), document.body);

}(window));

</script>
</html>